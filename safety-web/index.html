<!DOCTYPE html>
<html>
<head>
    <title>å®‰å…¨ç›‘æµ‹ç³»ç»Ÿ</title>
    <style>
        * { font-family: Arial; }
        body { padding: 40px; max-width: 800px; margin: auto; }
        button { padding: 12px 24px; margin: 10px; font-size: 16px; }
        input { padding: 10px; margin: 10px; width: 200px; }
        .hidden { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #f5f5f5; }
    </style>
</head>
<body>
    <div id="loginPage">
        <h1>ğŸ” é«˜ç©ºä½œä¸šå®‰å…¨ç›‘æµ‹ç³»ç»Ÿ</h1>
        <p>è¯·é€‰æ‹©ç™»å½•æ–¹å¼ï¼š</p>
        
        <button onclick="loginAsGuest()">ğŸ‘¤ æ¸¸å®¢è¿›å…¥ï¼ˆä»…æŸ¥çœ‹ï¼‰</button>
        
        <div style="margin-top: 30px;">
            <h3>ğŸ”‘ ç®¡ç†å‘˜ç™»å½•</h3>
            <p>ç®¡ç†å‘˜å¯†ç ï¼šadmin123</p>
            <input type="password" id="adminPass" placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            <button onclick="loginAsAdmin()">ç®¡ç†å‘˜ç™»å½•</button>
            <p id="errorMsg" style="color:red;"></p>
        </div>
    </div>

    <div id="mainPage" class="hidden">
        <h1>ğŸ“Š å®æ—¶ç›‘æ§é¢æ¿</h1>
        
        <div id="adminPanel" class="hidden">
            <h3>âš™ï¸ ç®¡ç†å‘˜æ§åˆ¶å°</h3>
            <button onclick="updateModel()" style="background:#4CAF50;color:white;">
                ğŸ”„ æ›´æ–°æ‰€æœ‰ç»ˆç«¯æ¨¡å‹
            </button>
            <p id="updateStatus"></p>
        </div>
        
        <h3>ğŸš¨ æŠ¥è­¦è®°å½•</h3>
        <table>
            <thead>
                <tr><th>æ—¶é—´</th><th>è®¾å¤‡</th><th>ç±»å‹</th><th>çŠ¶æ€</th></tr>
            </thead>
            <tbody id="alertTable">
                <tr><td colspan="4">åŠ è½½ä¸­...</td></tr>
            </tbody>
        </table>
        
        <div style="margin-top: 30px;">
            <button onclick="logout()">é€€å‡ºç™»å½•</button>
        </div>
    </div>

    <script>
        // é…ç½®ä½ çš„ Supabase ä¿¡æ¯ï¼ˆæ¢æˆä½ è‡ªå·±çš„ï¼‰
        const SUPABASE_URL = 'https://YOUR_PROJECT.supabase.co';
        const SUPABASE_KEY = 'YOUR_ANON_KEY';
        
        let isAdmin = false;
        const ADMIN_PASSWORD = 'admin123'; // ç®¡ç†å‘˜å¯†ç 
        
        // æ¸¸å®¢ç™»å½•
        function loginAsGuest() {
            isAdmin = false;
            showMainPage();
            loadAlerts();
        }
        
        // ç®¡ç†å‘˜ç™»å½•
        function loginAsAdmin() {
            const password = document.getElementById('adminPass').value;
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                showMainPage();
                loadAlerts();
            } else {
                document.getElementById('errorMsg').textContent = 'å¯†ç é”™è¯¯ï¼';
            }
        }
        
        // æ˜¾ç¤ºä¸»é¡µé¢
        function showMainPage() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            if (isAdmin) {
                document.getElementById('adminPanel').classList.remove('hidden');
            }
        }
        
        // åŠ è½½æŠ¥è­¦æ•°æ®
        async function loadAlerts() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/alerts?select=*&order=created_at.desc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                const data = await response.json();
                updateTable(data);
            } catch (error) {
                console.log('åŠ è½½æ•°æ®å‡ºé”™:', error);
            }
        }
        
        // æ›´æ–°è¡¨æ ¼
        function updateTable(alerts) {
            const table = document.getElementById('alertTable');
            table.innerHTML = '';
            
            if (alerts.length === 0) {
                table.innerHTML = '<tr><td colspan="4">æš‚æ— æŠ¥è­¦è®°å½•</td></tr>';
                return;
            }
            
            alerts.forEach(alert => {
                const row = `<tr>
                    <td>${new Date(alert.created_at).toLocaleString()}</td>
                    <td>${alert.device_id || 'æœªçŸ¥'}</td>
                    <td>${alert.alarm_type || 'å®‰å…¨å¤±ä¿'}</td>
                    <td>ğŸ”´ å¾…å¤„ç†</td>
                </tr>`;
                table.innerHTML += row;
            });
        }
        
        // æ›´æ–°æ¨¡å‹
        function updateModel() {
            document.getElementById('updateStatus').innerHTML = 
                '<p style="color: green;">âœ… æ¨¡å‹æ›´æ–°æŒ‡ä»¤å·²å‘é€åˆ°æ‰€æœ‰ç»ˆç«¯</p>';
        }
        
        // é€€å‡º
        function logout() {
            location.reload();
        }
        
        // æ¯5ç§’è‡ªåŠ¨åˆ·æ–°
        setInterval(loadAlerts, 5000);
    </script>
</body>
</html>